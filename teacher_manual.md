# 受験校調査システム 教員用利用マニュアル

本マニュアルは、「受験校調査システム」を利用する教員および管理者向けの手順書です。
生徒の受験校登録状況の確認、代理入力、およびマスターデータの管理方法について説明します。

---

## 目次
1. [システムの概要](#1-システムの概要)
2. [利用開始方法](#2-利用開始方法)
3. [生徒データの閲覧・代理入力](#3-生徒データの閲覧代理入力)
4. [管理者機能（スプレッドシート操作）](#4-管理者機能スプレッドシート操作)
5. [システム設定（入力期間の制御など）](#5-システム設定入力期間の制御など)
6. [トラブルシューティング](#6-トラブルシューティング)

---

## 1. システムの概要
本システムは、生徒が自身のスマートフォン等から入力した「受験校」「受験方式」「合否結果」をデータベース（Googleスプレッドシート）に集約するWebアプリです。

### 教員ができること
* **全生徒のデータ閲覧**: クラス・氏名を選択して状況を確認できます。
* **代理入力**: 生徒が操作できない場合などに、教員画面からデータを修正・登録できます。
* **調査書発行願の確認**: 生徒が発行申請を行うと、PDF付きメールが通知されます（設定による）。

---

## 2. 利用開始方法

1.  **アクセス**: 管理者から配布された **WebアプリのURL** にアクセスします。
2.  **ログイン**: 学校のGoogleアカウントでログインしてください。
3.  **画面表示**:
    * 画面上部に「【教員モード】[あなたのお名前]」と表示されていれば正常です。
    * ※初回アクセス時はデータの読み込みに数秒かかる場合があります。

---

## 3. 生徒データの閲覧・代理入力

教員モードでは、生徒の入力画面を閲覧・操作できます。

### 手順
1.  **クラス選択**: 画面上部のドロップダウンから対象のクラスを選択します。
2.  **生徒選択**: 右側のドロップダウンから生徒（出席番号・氏名）を選択します。
3.  **データ表示**:
    * 選択した生徒が既に登録しているデータが表示されます。
    * まだ登録がない場合は空欄が表示されます。
4.  **代理入力・修正**:
    * 必要に応じて内容を修正します（大学検索機能も使用可能です）。
    * **[送信]** ボタンを押すと、データベースが更新されます。

> **⚠️ 注意**:
> 教員が [送信] ボタンを押すと、**その時点で生徒が入力していたデータは上書きされます**。操作は慎重に行ってください。

---

## 4. 管理者機能（スプレッドシート操作）

データのメンテナンスは、データベースとなっている **Googleスプレッドシート** 上で行います。
スプレッドシートを開くと、メニューバーに **「校内DB用」** という独自のメニューが追加されています。

### 4.1 大学データの更新 (Benesseデータインポート)
Benesseから提供される入試データ（CSV等）を取り込みます。

1.  スプレッドシートに新しいシートを追加し、BenesseのCSVデータを貼り付けます。
2.  そのシートを開いた状態で、メニュー **「校内DB用」 > 「Benesse大学データインポート」** をクリックします。
3.  確認ダイアログで「はい」を選択します。
4.  `大学データ` シートが更新され、Webアプリ側の検索データも自動更新されます。

### 4.2 校内DB用データの生成
他の校務システム等に取り込むための形式（フラットファイル）を出力します。

1.  メニュー **「校内DB用」 > 「校内DB用データ生成」** をクリックします。
2.  `校内DB用` シートに、全生徒のデータが一覧形式で出力されます。

### 4.3 キャッシュクリア
「スプレッドシートを直接書き換えたが、Webアプリに反映されない」場合などに使用します。

1.  メニュー **「校内DB用」 > 「キャッシュクリア」** をクリックします。
2.  システムが保持している一時データが削除され、最新のシート情報が読み込まれるようになります。

### 4.4 削除レコード完全削除
生徒がアプリ上で「削除」したデータは、安全のためデータベース上では「削除フラグ」が立つだけで行は残っています（論理削除）。これを完全に消去する場合に使用します。

1.  メニュー **「校内DB用」 > 「削除レコード完全削除」** をクリックします。
2.  `受験校DB` シートから、削除フラグが `TRUE` の行が物理的に削除されます。

---

## 5. システム設定（入力期間の制御など）

スプレッドシートの **「設定」シート** を直接編集することで、システムの挙動を変更できます。

| 項目名 | 設定値の例 | 説明 |
| :--- | :--- | :--- |
| **ページタイトル** | 2024年度 受験校調査 | ブラウザのタブやヘッダーに表示されるタイトルです。 |
| **最大登録数** | 10 | 生徒1人あたりが登録できる受験校の上限数です。 |
| **入力許可** | `TRUE` / `FALSE` | **`FALSE` にすると、生徒は画面を開けてもデータの送信ができなくなります。** 締め切り後のロックに使用します。 |
| **メール件名** | 調査書発行願 | 発行願メールの件名です。 |
| **メール本文** | 先生、調査書をお願いします。 | 発行願メールの本文テンプレートです。 |

> **設定変更後の反映**:
> 「設定」シートの値を書き換えると、約3秒後に自動的にシステムに反映されます（画面右下に通知が出ます）。

---

## 6. トラブルシューティング

### Q. アプリの読み込みが遅い、または止まる
**A.** 初回アクセス時や、大学データを更新した直後は、キャッシュ生成のため10秒〜20秒程度時間がかかる場合があります。しばらく待つか、ブラウザをリロードしてください。

### Q. 「保存権限がありません」とエラーが出る
**A.** ログインしているGoogleアカウントが、「職員データ」シートに登録されていません。管理者に連絡し、メールアドレスを登録してもらってください。

### Q. 行を削除したが反映されない
**A.** スプレッドシートで行を削除（右クリック削除）した場合、Webアプリへの反映に数秒のタイムラグがあります（デバウンス処理のため）。3秒ほど待ってからアプリをリロードしてください。

### Q. 画面に「エラー」と表示される
**A.** エラーメッセージの詳細（「詳細: ...」の部分）を控え、システム管理者または開発者に連絡してください。